# Установка и удаление ПО, работа с пакетным менеджером cpkg

Пакетный менеджер `cpkg` - автоматизированная утилита для работы с пакетами. Она может устанавливать и удалять ПО, а так же показывать информацию о пакете. Конечно, возможностей у `cpkg` меньше, чем у других ПМ, но основной упор сделан на удобство и быструю работу, а не на богатый набор возможностей. Однако, того, что предоставляет `cpkg` вполне хватит.

## Синтаксис
```bash
cpkg [КЛЮЧИ] [ОПЦИИ] {ПАКЕТ}

## Установка пакета
```bash
cpkg install имя_пакета.txz
```

Так же, опцию `install` можно заменить на ключ `-i`.

> Пакетный менеджер cpkg ставит только локальные пакеты.
> Обработки зависимостей в нём нет и не будет.

## Удаление пакета
```bash
cpkg remove имя_пакета
```

Так же, опцию `remove` можно заменить на ключ `-r`.

Заметьте, что удаляются только те файлы, которые перечислены в соответствующей переменной файла `config.sh` нужного пакета. О строении пакета и `config.sh` будет написано в соответствующем пункте.

## Дополнительные опции
О работе с дополнительными опциями написано в инструкции:
```bash
cpkg help
```

## Создание бинарного пакета для `cpkg`
Пакет для `cpkg` представляет собой tar архив, сжатый методом `xz`. В архиве находится директория PKG, в которой находятся файлы `config.sh`, `preinst.sh` (опционально), `postinst.sh` (опционально), а так же директория `pkg`, в которой находится сам пакет. Дерево каталогов пакета должно совпадать с деревом каталогов операционной системы.

**Назначение файлов и директорий:**
* `PKG` - в этой директории находятся сам пакет и файлы описания, а так же файлы пред- и послеустановочных настроек.
* `PKG/pkg` - директория с пакетом
* `PKG/config.sh` - описание пакета
* `PKG/preinst.sh` - скрипт, выполняющийся до установки пакета. Может быть полезен для настройки системы или окружения перед установкой пакета. Наличие этого файла ***опционально***
* `PKG/postinst.sh` - скрипт, выполняющийся после установки пакета. Может быть полезен для настройки пакета. Наличие этого файла ***опционально***

Тогда дерево каталогов пакета будет примерно таким:
```
|--- some_package.txz
|   |--- PKG
|       |--- config.sh
|       |--- {post,pre}inst.sh
|       |--- pkg
|           |--- usr
|           |--- etc
|           |--- var
|           |--- ...
```

### Строение файла `config.sh`
В этом файле описывается сам пакет. В нём указывается имя пакета, версия, мейнтейнер, описание и файлы пакета.
Пример такого файла:
```bash
NAME=some_package
VERSION=1.0
MAINTAINER="Linuxoid85 <linuxoid85@gmail.com>"
DESCRIPTION="Some package for test cpkg package manager"
FILES="/usr/bin/{some_pkg,test_cpkg} /usr/share/some_pkg/"
```

**Описание переменных:**
* `NAME` - имя пакета
* `VERSION` - версия пакета/программы
* `MAINTAINER` - сборщик (сопровождающий) пакета
* `DESCRIPTION` - описание пакета
* `FILES` - все файлы пакета.

Если в одной директории (чаще всего это `/bin`, `/usr/bin`, `/etc` и пр.) несколько файлов из пакета, то нет смысла дублировать пути до этих файлов. Проще объединить их в массив. К примеру, есть директория `/usr/bin`, в которую устанавливаются файлы `some_pkg` и `test_cpkg`. В строке `FILES="..."` они объединены в массив `/usr/bin/{some_pkg,test_cpkg}`. То есть, файлы перечисляются в фигурных скобках {}.

Так же, все отдельные файлы разделяются между собой пробелами.

### Строение файлов `post-` и `preinst.sh`
Как было сказано выше, первый файл выполняется до установки пакета, а второй - после. Они нужны для настройки окружения или системы (до установки) и пакета (после установки). Эти файлы - BASH-скрипты.

> Шебанг `#!/bin/bash` обязателен.

***
На этом руководство по использованию `cpkg` окончено.

Удачи!
