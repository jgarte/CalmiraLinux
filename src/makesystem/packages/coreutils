#!/bin/bash

NAME="coreutils"
VERSION="8.32"

{ time \
    {
        tar -xf $NAME-$VERSION.tar.xz &&
        cd $NAME-$VERSION &&

        patch -Np1 -i ../$NAME-$VERSION-i18n-1.patch &&
        sed -i '/test.lock/s/^/#/' gnulib-tests/gnulib.mk &&

        autoreconf -fiv &&
        FORCE_UNSAFE_CONFIGURE=1 ./configure \
                --prefix=/usr                \
                --enable-no-install-program=kill,uptime &&
            
        make &&
        make install &&

        mv -v /usr/bin/{cat,chgrp,chmod,chown,cp,date,dd,df,echo} /bin &&
        mv -v /usr/bin/{false,ln,ls,mkdir,mknod,mv,pwd,rm} /bin &&
        mv -v /usr/bin/{rmdir,stty,sync,true,uname} /bin &&
        mv -v /usr/bin/chroot /usr/sbin &&
        mv -v /usr/share/man/man1/chroot.1 /usr/share/man/man8/chroot.8 &&
        sed -i 's/"1"/"8"/' /usr/share/man/man8/chroot.8 &&

        mv -v /usr/bin/{head,nice,sleep,touch} /bin
    }
} 2>&1 | tee /var/log/system_building/packages/$NAME.log